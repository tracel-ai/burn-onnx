#!/usr/bin/env -S uv run --script

# /// script
# dependencies = [
#   "onnx==1.19.0",
#   "numpy",
# ]
# ///

# used to generate model: lstm_reverse.onnx

import numpy as np
import onnx
from onnx import helper, TensorProto, numpy_helper

OPSET_VERSION = 16


def main():
    init_onnx__LSTM_110 = numpy_helper.from_array(np.array([0.27030518651008606, 0.29345211386680603, -0.08282782882452011, 0.32477813959121704, -0.07746481150388718, 0.07134377956390381, -0.17212924361228943, 0.2076357752084732, 0.31167247891426086, -0.2593767046928406, 0.30730724334716797, 0.06617080420255661, 0.2612083852291107, 0.04788193851709366, 0.17047923803329468, -0.049918558448553085, 0.2725493013858795, 0.052258338779211044, -0.16505283117294312, 0.09012015908956528, -0.16289499402046204, -0.041462212800979614, -0.14359864592552185, 0.2345370501279831, -0.2790845036506653, -0.16299176216125488, -0.09983454644680023, -0.21258191764354706, 0.03336947038769722, -0.34919729828834534, 0.31929728388786316, -0.30033236742019653, 0.32373538613319397, -0.11930040270090103, -0.12534046173095703, -0.34209635853767395, -0.20246949791908264, 0.08831892907619476, -0.04666663333773613, -0.2566394507884979, 0.008293192833662033, -0.24150577187538147, -0.29995352029800415, -0.19468863308429718, -0.3094342052936554, -0.2251209020614624, 0.3534151017665863, 0.06677737832069397, 0.1089509055018425, -0.32975369691848755, -0.2322046011686325, -0.11768230050802231, 0.055285535752773285, -0.31109917163848877, -0.15233662724494934, -0.21166129410266876, 0.0009797877864912152, -0.1315583437681198, -0.02449975162744522, -0.2395782768726349, -0.24267733097076416, -0.2062636762857437, -0.12102041393518448, -0.2790529429912567, 0.2729528844356537, 0.05883805453777313, -0.11480038613080978, 0.21847830712795258, 0.05510156601667404, 0.28565818071365356, 0.03865034505724907, -0.11150125414133072, 0.09499402344226837, -0.09587641060352325, 0.14879560470581055, 0.315660297870636, 0.20437490940093994, -0.15456382930278778, 0.20409387350082397, 0.06325997412204742, 0.1795467883348465, -0.21549257636070251, -0.3499854803085327, -0.1365990787744522, -0.2711835205554962, 0.29010429978370667, 0.10183445364236832, 0.1464466005563736, 0.1118152067065239, -0.006150405388325453, 0.27669379115104675, -0.2512044906616211, 0.022261038422584534, -0.24131439626216888, 0.10901889204978943, -0.12175752222537994, 0.1083345115184784, -0.07365983724594116, 0.29323428869247437, -0.20955176651477814, -0.2108585238456726, -0.21087126433849335, 0.31800103187561035, 0.1178220584988594, 0.34020698070526123, -0.29177922010421753, -0.3506811559200287, -0.27660736441612244, -0.2378315031528473, 0.14320331811904907, 0.12659892439842224, 0.29377612471580505, -0.18258394300937653, -0.2410215139389038, 0.1875876933336258, -0.14290785789489746, 0.2145799696445465, -0.08389844000339508, 0.20224876701831818, -0.2746996581554413, -0.17842063307762146, 0.10779009759426117, 0.07474385201931, -0.09014152735471725, 0.21074236929416656, 0.24034884572029114, -0.25638750195503235, -0.18875090777873993], dtype=np.float32).reshape([1, 32, 4]), name="onnx::LSTM_110")

    init_onnx__LSTM_111 = numpy_helper.from_array(np.array([0.2964438498020172, -0.07016763091087341, 0.30419617891311646, 0.11016090214252472, -0.29938793182373047, 0.24467138946056366, -0.09727837890386581, -0.13552622497081757, -0.2934742271900177, -0.35148885846138, 0.10115538537502289, -0.07723157107830048, 0.13764651119709015, -0.2901483476161957, 0.26248833537101746, -0.25952717661857605, -0.06104924529790878, 0.07384658604860306, 0.18252256512641907, 0.2854273021221161, 0.32207271456718445, -0.280340313911438, 0.08897781372070312, -0.1520724892616272, -0.03874408081173897, -0.2646312117576599, 0.3220371603965759, -0.2594906687736511, 0.18895705044269562, 0.12425266206264496, 0.11488927155733109, -0.19114729762077332, 0.3213628828525543, 0.07769349962472916, 0.045481126755476, -0.3115706145763397, 0.1484176367521286, -0.053040292114019394, -0.16197139024734497, 0.30368345975875854, 0.07882429659366608, -0.19561274349689484, -0.17894713580608368, -0.016884196549654007, 0.19741052389144897, -0.09034484624862671, -0.2017286866903305, -0.12107183784246445, -0.2641308307647705, 0.12608861923217773, 0.27366453409194946, -0.3328494131565094, 0.08211302012205124, 0.18264277279376984, 0.06410961598157883, -0.12590907514095306, 0.18453441560268402, 0.18579696118831635, 0.13220323622226715, -0.062126897275447845, -0.0936213806271553, 0.03782346472144127, -0.062456656247377396, -0.1053592786192894, -0.24573200941085815, -0.0728592574596405, 0.26183590292930603, 0.18124766647815704, -0.22372469305992126, -0.28350916504859924, -0.24160553514957428, -0.34891393780708313, -0.2728155851364136, -0.08743283152580261, 0.23860511183738708, 0.05917855724692345, -0.2689146399497986, -0.2836289703845978, 0.17588406801223755, -0.2629876136779785, -0.043532129377126694, 0.1696016937494278, -0.16362877190113068, -0.03855142742395401, -0.03077486902475357, -0.08364484459161758, -0.1792629361152649, -0.3151710629463196, -0.2857973575592041, -0.18931429088115692, 0.3414751887321472, -0.17077147960662842, -0.23742099106311798, 0.08569929003715515, 0.09744296222925186, 0.19371534883975983, 0.2687431275844574, 0.19688473641872406, -0.35054853558540344, 0.03135615959763527, 0.2141660451889038, -0.032677337527275085, -0.20834164321422577, 0.3370565176010132, -0.13223880529403687, -0.2012936770915985, -0.3187478482723236, 0.015792634338140488, 0.1566712111234665, 0.07826358079910278, 0.06991508603096008, -0.26813045144081116, -0.33017900586128235, 0.006225848104804754, 0.32238203287124634, 0.2039724886417389, -0.20585089921951294, -0.04589425027370453, -0.2606337368488312, -0.17056243121623993, 0.06402793526649475, 0.19252343475818634, 0.29287275671958923, -0.3245995044708252, 0.23639117181301117, -0.2493584156036377, 0.13239416480064392, 0.299192875623703, 0.22599375247955322, 0.30384361743927, -0.03500084951519966, -0.07915949076414108, 0.00515915360301733, -0.02111005038022995, 0.084998220205307, 0.09907754510641098, -0.32111725211143494, -0.1304745376110077, 0.297737717628479, 0.1377284824848175, -0.01758488640189171, -0.21315936744213104, -0.21630576252937317, -0.31670141220092773, -0.11524511873722076, 0.11939645558595657, 0.22543329000473022, 0.1632346510887146, -0.31252139806747437, -0.21261373162269592, -0.05579661205410957, 0.34200969338417053, 0.05114414542913437, -0.0915599837899208, 0.14627042412757874, -0.1346619576215744, -0.2288394272327423, 0.25805410742759705, -0.16076135635375977, -0.07087569683790207, -0.35171642899513245, 0.2366228997707367, 0.26786428689956665, 0.12885189056396484, -0.2465236634016037, -0.34893593192100525, -0.2871486246585846, 0.26364484429359436, 0.16974301636219025, 0.29751673340797424, 0.18521596491336823, 0.08948159217834473, -0.003462237073108554, -0.2688794732093811, -0.30291470885276794, -0.3306956887245178, 0.1447313129901886, -0.17358338832855225, -0.07115352898836136, -0.2034718245267868, -0.0644257590174675, -0.2488432079553604, -0.2310173213481903, 0.11727748066186905, -0.10507478564977646, 0.21826377511024475, -0.11342302709817886, -0.25935518741607666, -0.062380578368902206, -0.1713840812444687, -0.10816667973995209, -0.3365812599658966, 0.19780990481376648, -0.24614547193050385, 0.1777021884918213, 0.1604369431734085, 0.2525900900363922, -0.27119386196136475, 0.2542744576931, -0.16714292764663696, 0.13119277358055115, 0.3320271670818329, -0.04986229166388512, -0.0027341924142092466, -0.08139880001544952, -0.2952116131782532, 0.16967128217220306, -0.3509787619113922, 0.21948590874671936, 0.264537513256073, 0.33435767889022827, -0.08339601010084152, -0.29049429297447205, 0.07948949933052063, 0.19531254470348358, -0.3518947660923004, -0.08025084435939789, -0.2119395136833191, -0.03092310018837452, -0.17402374744415283, -0.14452116191387177, -0.11223866045475006, -0.3359832167625427, 0.29009321331977844, 0.29639485478401184, -0.055461585521698, -0.04026338830590248, -0.1442921757698059, -0.3192809224128723, -0.3440585136413574, 0.13140110671520233, -0.19411712884902954, -0.22729133069515228, -0.027585364878177643, -0.11773721873760223, -0.11438186466693878, 0.011360093019902706, -0.0749930664896965, -0.12173282355070114, -0.1692834496498108, -0.28773143887519836, 0.29645705223083496, -0.1414875090122223, 0.09368439018726349, -0.1226709708571434, 0.028730198740959167, 0.329617977142334, 0.16289006173610687, -0.3063892424106598, 0.14032632112503052, 0.33560800552368164, 0.09301400184631348, 0.23703092336654663, 0.34856387972831726, -0.05417463183403015, 0.07338158041238785], dtype=np.float32).reshape([1, 32, 8]), name="onnx::LSTM_111")

    init_onnx__LSTM_112 = numpy_helper.from_array(np.array([0.004964730236679316, 0.32166606187820435, -0.30124568939208984, -0.1350429654121399, 0.20621104538440704, -0.07702791690826416, -0.07237245887517929, -0.14735810458660126, -0.1797187477350235, 0.11015082895755768, -0.1029231920838356, -0.13831789791584015, 0.33708834648132324, 0.12315072864294052, 0.2520490288734436, -0.17115969955921173, 0.24370652437210083, 0.1734190583229065, 0.11329620331525803, -0.19868415594100952, -0.2869968116283417, 0.03824055194854736, 0.1047503873705864, -0.16323979198932648, -0.09892341494560242, 0.23877854645252228, 0.028163956478238106, 0.015951739624142647, -0.08700968325138092, -0.32017430663108826, -0.33243119716644287, -0.16900384426116943, -0.14441482722759247, 0.12994517385959625, -0.23556382954120636, -0.2311192750930786, -0.017076512798666954, -0.12931592762470245, -0.26504412293434143, 0.20971335470676422, -0.10684327036142349, 0.2570782005786896, -0.00919138453900814, 0.2759835720062256, 0.33993467688560486, -0.1722480207681656, -0.25792041420936584, 0.28365659713745117, 0.28431451320648193, 0.05735461041331291, -0.06155833601951599, -0.32748696208000183, -0.12877783179283142, 0.09000960737466812, 0.16671134531497955, -0.04469534009695053, -0.13977833092212677, 0.1970091611146927, -0.28156980872154236, 0.22345209121704102, -0.13716274499893188, 0.005411276128143072, -0.06986775994300842, 0.042864441871643066], dtype=np.float32).reshape([1, 64]), name="onnx::LSTM_112")

    node0 = helper.make_node(
        "Constant", [], ["/lstm/Constant_output_0"],
        value=numpy_helper.from_array(np.array([0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], dtype=np.float32).reshape([1, 2, 8]), name="value"))
    node1 = helper.make_node(
        "Shape", ["input"], ["/lstm/Shape_output_0"])
    node2 = helper.make_node(
        "Constant", [], ["/lstm/Constant_1_output_0"],
        value=numpy_helper.from_array(np.array([1], dtype=np.int64).reshape([]), name="value"))
    node3 = helper.make_node(
        "Gather", ["/lstm/Shape_output_0", "/lstm/Constant_1_output_0"], ["/lstm/Gather_output_0"])
    node4 = helper.make_node(
        "Constant", [], ["onnx::Unsqueeze_69"],
        value=numpy_helper.from_array(np.array([0], dtype=np.int64).reshape([1]), name="value"))
    node5 = helper.make_node(
        "Unsqueeze", ["/lstm/Gather_output_0", "onnx::Unsqueeze_69"], ["onnx::Concat_70"])
    node6 = helper.make_node(
        "Constant", [], ["/lstm/Constant_2_output_0"],
        value=numpy_helper.from_array(np.array([8], dtype=np.int64).reshape([1]), name="value"))
    node7 = helper.make_node(
        "Constant", [], ["onnx::Concat_113"],
        value=numpy_helper.from_array(np.array([1], dtype=np.int64).reshape([1]), name="value"))
    node8 = helper.make_node(
        "Concat", ["onnx::Concat_113", "onnx::Concat_70", "/lstm/Constant_2_output_0"], ["/lstm/Concat_output_0"],
        axis=0)
    node9 = helper.make_node(
        "Expand", ["/lstm/Constant_output_0", "/lstm/Concat_output_0"], ["/lstm/Expand_output_0"])
    node10 = helper.make_node(
        "Shape", ["input"], ["/lstm/Shape_1_output_0"])
    node11 = helper.make_node(
        "Constant", [], ["/lstm/Constant_3_output_0"],
        value=numpy_helper.from_array(np.array([1], dtype=np.int64).reshape([]), name="value"))
    node12 = helper.make_node(
        "Gather", ["/lstm/Shape_1_output_0", "/lstm/Constant_3_output_0"], ["/lstm/Gather_1_output_0"])
    node13 = helper.make_node(
        "Constant", [], ["onnx::Unsqueeze_80"],
        value=numpy_helper.from_array(np.array([0], dtype=np.int64).reshape([1]), name="value"))
    node14 = helper.make_node(
        "Unsqueeze", ["/lstm/Gather_1_output_0", "onnx::Unsqueeze_80"], ["onnx::Concat_81"])
    node15 = helper.make_node(
        "Constant", [], ["/lstm/Constant_4_output_0"],
        value=numpy_helper.from_array(np.array([8], dtype=np.int64).reshape([1]), name="value"))
    node16 = helper.make_node(
        "Constant", [], ["onnx::Concat_114"],
        value=numpy_helper.from_array(np.array([1], dtype=np.int64).reshape([1]), name="value"))
    node17 = helper.make_node(
        "Concat", ["onnx::Concat_114", "onnx::Concat_81", "/lstm/Constant_4_output_0"], ["/lstm/Concat_1_output_0"],
        axis=0)
    node18 = helper.make_node(
        "Expand", ["/lstm/Constant_output_0", "/lstm/Concat_1_output_0"], ["/lstm/Expand_1_output_0"])
    node19 = helper.make_node(
        "LSTM", ["input", "onnx::LSTM_110", "onnx::LSTM_111", "onnx::LSTM_112", "", "/lstm/Expand_output_0", "/lstm/Expand_1_output_0"], ["/lstm/LSTM_output_0", "h_n", "c_n"],
        hidden_size=8,
        direction="reverse")
    node20 = helper.make_node(
        "Constant", [], ["/lstm/Constant_5_output_0"],
        value=numpy_helper.from_array(np.array([1], dtype=np.int64).reshape([1]), name="value"))
    node21 = helper.make_node(
        "Squeeze", ["/lstm/LSTM_output_0", "/lstm/Constant_5_output_0"], ["output"])

    inp_input = helper.make_tensor_value_info("input", TensorProto.FLOAT, [5, 2, 4])

    out_output = helper.make_tensor_value_info("output", TensorProto.FLOAT, [5, 2, 8])
    out_h_n = helper.make_tensor_value_info("h_n", TensorProto.FLOAT, [1, 2, 8])
    out_c_n = helper.make_tensor_value_info("c_n", TensorProto.FLOAT, [1, 2, 8])

    graph = helper.make_graph(
        [node0, node1, node2, node3, node4, node5, node6, node7, node8, node9, node10, node11, node12, node13, node14, node15, node16, node17, node18, node19, node20, node21],
        "main_graph",
        [inp_input],
        [out_output, out_h_n, out_c_n],
        initializer=[init_onnx__LSTM_110, init_onnx__LSTM_111, init_onnx__LSTM_112],
    )
    model = helper.make_model(graph, opset_imports=[helper.make_operatorsetid("", OPSET_VERSION)])

    onnx.save(model, "lstm_reverse.onnx")
    print(f"Finished exporting model to lstm_reverse.onnx")


if __name__ == "__main__":
    main()
