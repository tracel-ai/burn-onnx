#!/usr/bin/env -S uv run --script

# /// script
# dependencies = [
#   "onnx==1.19.0",
#   "numpy",
# ]
# ///

# used to generate model: graph_multiple_output_tracking.onnx

import numpy as np
import onnx
from onnx import helper, TensorProto, numpy_helper

OPSET_VERSION = 16


def main():
    # Large initializer: (16, 32), float32
    init_fc1_weight = numpy_helper.from_array(np.array([0.142910435795784, -0.1712695062160492, -0.07207076996564865, -0.11465944349765778, 0.07175010442733765, 0.037880197167396545, 0.023746207356452942, 0.1152990311384201, -0.1144147664308548, -0.14651237428188324, -0.1427532136440277, 0.11587785184383392, -0.15350666642189026, 0.11201564967632294, -0.0918426588177681, -0.11511513590812683, 0.02554526925086975, -0.08115870505571365, -0.09914793074131012, 0.006930455565452576, 0.05739486217498779, -0.0716746374964714, -0.016167044639587402, 0.11904637515544891, 0.17460910975933075, -0.05380237102508545, 0.040203168988227844, -0.13873496651649475, 0.1585083156824112, -0.07505810260772705, 0.1060314029455185, -0.15868139266967773, 0.09526549279689789, 0.07013170421123505, 0.04811359941959381, 0.12465314567089081, 0.1129007488489151, 0.06525775790214539, -0.12210523337125778, 0.1547214835882187, -0.0768013522028923, -0.15871840715408325, -0.04910506308078766, 0.030363813042640686, -0.09056015312671661, 0.1293909102678299, -0.111763134598732, 0.014470234513282776, 0.13232757151126862, 0.1073341816663742, -0.009749174118041992, 0.14222706854343414, 0.009820863604545593, 0.095762237906456, -0.15035352110862732, -0.17405281960964203, -0.07712778449058533, 0.06956744194030762, 0.06437887251377106, 0.17427609860897064, -0.17669127881526947, -0.013414755463600159, 0.12725414335727692, -0.06784458458423615, -0.030798688530921936, 0.12059523165225983, 0.08614067733287811, -0.013062402606010437, -0.029371321201324463, 0.002468883991241455, 0.09040708839893341, 0.04276660084724426, -0.011664330959320068, 0.16091783344745636, 0.11357371509075165, 0.016282260417938232, 0.07597129046916962, 0.07739679515361786, 0.12738414108753204, 0.08918462693691254, -0.034522607922554016, -0.16172181069850922, -0.12021290510892868, -0.1480175107717514, -0.14955668151378632, 0.09999017417430878, 0.013771295547485352, -0.08518017083406448, -0.05131120979785919, 0.15575437247753143, 0.15581677854061127, 0.027561679482460022, -0.12496751546859741, 0.13884498178958893, 0.09160308539867401, 0.058013007044792175, 0.02880549430847168, -0.13628752529621124, -0.16470423340797424, 0.16759060323238373, -0.1616314798593521, -0.06668918579816818, -0.08625828474760056, 0.07753412425518036, 0.02731822431087494, 0.08194254338741302, -0.11867203563451767, 0.03655025362968445, 0.10456545650959015, -0.17340922355651855, 0.00806395709514618, 0.17010356485843658, -0.05102516710758209, 0.054351478815078735, 0.02220885455608368, -0.16633936762809753, -0.07240278273820877, -0.11385267227888107, 0.1370028704404831, -0.08158854395151138, 0.04040767252445221, 0.07973717153072357, -0.033659666776657104, 0.05242420732975006, -0.05022814869880676, 0.15977822244167328, -0.17062480747699738, 0.028037235140800476, -0.057512640953063965, -0.03431814908981323, 0.15920566022396088, 0.011837497353553772, 0.06034982204437256, 0.01474606990814209, -0.16106916964054108, -0.15360888838768005, 0.04981920123100281, -0.09342040866613388, -0.05236360430717468, 0.14374174177646637, 0.1420539766550064, -0.06701304763555527, 0.16079778969287872, 0.008351236581802368, 0.10426472127437592, -0.0201251357793808, 0.034940049052238464, 0.061364904046058655, 0.11499004065990448, 0.02605922520160675, 0.048982441425323486, -0.07639322429895401, -0.16058167815208435, -0.03364504873752594, -0.0442417711019516, -0.016808897256851196, -0.08601672202348709, 0.16252805292606354, -0.102336086332798, 0.17222486436367035, 0.04555949568748474, 0.04719153046607971, -0.09294816851615906, -0.15098506212234497, 0.07459710538387299, -0.003104284405708313, 0.10057447850704193, 0.06694267690181732, 0.045444056391716, -0.042195260524749756, 0.12351317703723907, 0.025525718927383423, 0.12212489545345306, -0.07989875227212906, 0.13918675482273102, -0.13955453038215637, -0.14889025688171387, 0.14816562831401825, 0.05567166209220886, -0.15903310477733612, 0.1500231772661209, 0.11047492921352386, 0.09446494281291962, -0.0848773866891861, 0.10595162212848663, -0.025629565119743347, 0.11236830055713654, -0.12593477964401245, 0.03572387993335724, -0.037571653723716736, 0.01720777153968811, 0.07293887436389923, 0.15362070500850677, 0.17452310025691986, -0.10661700367927551, 0.06151612102985382, -0.05710434168577194, 0.09126622974872589, 0.004501283168792725, -0.12820005416870117, 0.13408641517162323, -0.12374984472990036, 0.153786763548851, 0.018148154020309448, 0.03327646851539612, -0.16453680396080017, 0.16305126249790192, 0.1619454175233841, -0.10928741097450256, -0.0951484888792038, 0.15244795382022858, -0.055605851113796234, 0.08968131244182587, -0.06131211668252945, 0.07568706572055817, -0.05726940929889679, -0.11815597116947174, 0.014043033123016357, -0.12605538964271545, 0.03360334038734436, 0.09573452174663544, 0.12515507638454437, 0.15377451479434967, -0.12740544974803925, 0.05822378396987915, 0.06139853596687317, -0.11818315088748932, 0.023003414273262024, -0.11464104801416397, 0.15112625062465668, -0.17433318495750427, -0.17602376639842987, 0.10439686477184296, -0.1374981701374054, 0.1275167316198349, -0.03513661026954651, -0.008060306310653687, 0.15370018780231476, 0.16256828606128693, -0.008072927594184875, -0.14768996834754944, 0.01673521101474762, 0.006572544574737549, 0.0657871812582016, 0.024677693843841553, -0.17406918108463287, 0.017832159996032715, 0.15129421651363373, -0.04227536916732788, 0.023172900080680847, 0.09077335894107819, -0.007422834634780884, 0.1184234470129013, 0.12623761594295502, 0.07741491496562958, -0.04869543015956879, 0.10859136283397675, -0.17565631866455078, -0.11378215998411179, -0.15665197372436523, -0.04380062222480774, 0.04023824632167816, 0.019983142614364624, 0.0918523520231247, -0.10189386457204819, 0.12932832539081573, -0.1581588089466095, -0.10350508987903595, 0.07544104754924774, 0.10323204100131989, 0.05287182331085205, 0.1405291110277176, -0.08328606933355331, -0.01430925726890564, 0.11826194822788239, -0.10522976517677307, 0.092667356133461, -0.13609880208969116, -0.13048459589481354, 0.07975463569164276, -0.15622404217720032, 0.06670959293842316, 0.07162511348724365, 0.06459963321685791, 0.15148966014385223, -0.08475925028324127, 0.13570339977741241, -0.1407337784767151, -0.025932982563972473, 0.13207833468914032, -0.17183592915534973, 0.09947578608989716, 0.14012552797794342, -0.09645042568445206, -0.12061955779790878, 0.1190279871225357, -0.1257462501525879, 0.15274034440517426, -0.06970725953578949, 0.1406686156988144, 0.06141257286071777, -0.013991504907608032, 0.15488283336162567, 0.05654919147491455, 0.058132827281951904, 0.16923265159130096, -0.15533491969108582, -0.11536610126495361, -0.1387442648410797, 0.08456365764141083, 0.09129385650157928, -0.1197066605091095, 0.14569656550884247, -0.03698243200778961, 0.13586373627185822, -0.17677246034145355, 0.1698787957429886, -0.10774081200361252, 0.1743420511484146, 0.15216363966464996, 0.15689300000667572, -0.015280693769454956, 0.1330612748861313, -0.07803438603878021, 0.09582941234111786, -0.02099543809890747, -0.02355775237083435, 0.0018370896577835083, -0.1082695797085762, -0.02597588300704956, 0.0640297681093216, 0.030349403619766235, 0.15485166013240814, 0.055594563484191895, -0.14922288060188293, -0.17032334208488464, -0.15025785565376282, 0.12498526275157928, -0.15640725195407867, 0.11988683044910431, 0.1402573436498642, -0.051491186022758484, 0.0868818610906601, -0.1168893501162529, 0.12596945464611053, -0.0012098848819732666, -0.06256476044654846, 0.08456386625766754, -0.053085342049598694, 0.13397915661334991, 0.12504400312900543, 0.05040505528450012, 0.11360059678554535, -0.08302608877420425, 0.038199082016944885, -0.08784404397010803, -0.07056084275245667, 0.10818670690059662, 0.10474281013011932, 0.10848484933376312, -0.13048475980758667, -0.09937025606632233, -0.08693617582321167, -0.011110350489616394, 0.1651812642812729, 0.08481328189373016, 0.023348107933998108, -0.07887224107980728, -0.09770949929952621, 0.17213569581508636, -0.1255960911512375, -0.14176324009895325, -0.07773587852716446, -0.14661122858524323, 0.07639290392398834, 0.052388995885849, 0.1492437869310379, -0.03903190791606903, 0.0453093945980072, 0.1257639080286026, -0.016127318143844604, -0.016771137714385986, 0.013887032866477966, 0.09506143629550934, 0.14373500645160675, 0.0038169920444488525, 0.17114846408367157, -0.15916217863559723, 0.04219931364059448, -0.055831633508205414, -0.00047394633293151855, -0.025679543614387512, -0.1727868765592575, -0.10862047970294952, 0.04254111647605896, -0.1669776737689972, -0.100581094622612, -0.07446496933698654, 0.07863296568393707, -0.0233871191740036, 0.06439217925071716, 0.01017799973487854, -0.06789989769458771, 0.1025237888097763, -0.09082681685686111, -0.007110461592674255, -0.016164809465408325, -0.0001070946455001831, 0.17650796473026276, 0.14856316149234772, -0.015439018607139587, 0.11564497649669647, -0.03673215210437775, -0.00883568823337555, -0.023803099989891052, 0.10587801039218903, 0.16768838465213776, 0.06903311610221863, 0.0713701844215393, -0.17281673848628998, -0.16307884454727173, 0.07322879135608673, 0.027922391891479492, -0.08984426409006119, 0.059758082032203674, -0.0774460956454277, 0.13282622396945953, 0.1648309975862503, -0.022912368178367615, 0.16068370640277863, -0.14362415671348572, -0.056571103632450104, -0.06686658412218094, -0.028150737285614014, 0.100736603140831, 0.13321755826473236, -0.13384386897087097, 0.15845485031604767, -0.03696490824222565, 0.05807603895664215, -0.0573430210351944, 0.13723711669445038, -0.02915927767753601, 0.06855940818786621, 0.15890704095363617, -0.12760096788406372, -0.05797009915113449, -0.14422853291034698, 0.09202779829502106, -0.003284171223640442, 0.14818288385868073, -0.12116508185863495, -0.08585521578788757, 0.10431124269962311, 0.10302169620990753, 0.021342024207115173, 0.047351688146591187, 0.014416292309761047, -0.09044831246137619, 0.09521810710430145, -0.122499980032444, 0.12803955376148224, -0.05836240202188492, -0.17548689246177673, 0.13565535843372345, 0.007432654500007629, 0.0452861487865448, 0.15473465621471405, -0.028140604496002197, 0.11076746881008148, 0.028811663389205933, -0.009793773293495178, -0.086181640625, -0.11137726157903671, 0.13031195104122162, -0.06508004665374756, -0.12327992916107178, -0.015105366706848145, -0.10913064330816269, -0.06421740353107452, 0.09579204022884369, 0.11654962599277496, -0.15542484819889069, 0.11267434060573578, 0.14335878193378448, -0.1729384809732437, -0.10555703192949295, 0.14872212707996368, -0.05439724773168564, -0.10335978865623474, 0.0009278059005737305, 0.170567587018013, 0.06660228967666626, -0.12162353843450546, -0.015108168125152588, -0.07807665318250656, -0.03180035948753357, -0.15321867167949677, 0.16152922809123993, -0.039641156792640686, 0.09686465561389923, -0.15163680911064148, 0.0840422660112381, 0.14388497173786163, 0.14134739339351654, 0.16173873841762543, 0.003029346466064453, -0.13320191204547882, -0.1536996066570282, -0.17532998323440552, -0.07158810645341873, -0.11657913029193878], dtype=np.float32).reshape([16, 32]), name="fc1.weight")

    init_fc1_bias = numpy_helper.from_array(np.array([-0.15942668914794922, -0.09259386360645294, -0.17114190757274628, -0.04316669702529907, -0.13888061046600342, -0.13816550374031067, -0.13862599432468414, -0.1487281322479248, -0.13455714285373688, -0.0785231813788414, -0.003240033984184265, -0.1652676910161972, -0.14939714968204498, -0.13078583776950836, -0.17596811056137085, -0.1674112230539322], dtype=np.float32).reshape([16]), name="fc1.bias")

    init_fc2_weight = numpy_helper.from_array(np.array([0.24022388458251953, 0.056073158979415894, 0.09015905857086182, -0.17499065399169922, -0.09554648399353027, 0.0792260468006134, -0.07474356889724731, 0.01914304494857788, 0.1014268696308136, -0.15539520978927612, 0.08313769102096558, 0.21030539274215698, 0.19345727562904358, 0.07110446691513062, 0.07856392860412598, 0.09827098250389099, -0.047112345695495605, 0.23487478494644165, -0.20288196206092834, -0.14521774649620056, -0.00024315714836120605, 0.2353672981262207, 0.005449354648590088, 0.0572228729724884, 0.12634631991386414, -0.1850365698337555, 0.23435109853744507, 0.032298654317855835, -0.18931147456169128, -0.041930168867111206, 0.147739976644516, 0.16591262817382812], dtype=np.float32).reshape([2, 16]), name="fc2.weight")

    init_fc2_bias = numpy_helper.from_array(np.array([-0.09923714399337769, -0.015028059482574463], dtype=np.float32).reshape([2]), name="fc2.bias")

    init_fc3_weight = numpy_helper.from_array(np.array([-0.19719526171684265, -0.14914804697036743, -0.06270349025726318, 0.17330461740493774, 0.12268999218940735, 0.0638059675693512, -0.16159966588020325, -0.13058021664619446, 0.1409180462360382, -0.20188835263252258, -0.15124475955963135, 0.09269252419471741, -0.1531476378440857, -0.13462242484092712, -0.22039511799812317, -0.24684405326843262, -0.2366465926170349, -0.013331979513168335, 0.11626338958740234, -0.153531014919281, -0.12743598222732544, -0.17590588331222534, 0.0756688117980957, 0.1600390374660492, -0.06065109372138977, 0.030843883752822876, -0.22399556636810303, 0.21310684084892273, 0.044956326484680176, -0.24729189276695251, 0.21057796478271484, 0.09266149997711182], dtype=np.float32).reshape([2, 16]), name="fc3.weight")

    init_fc3_bias = numpy_helper.from_array(np.array([0.007893800735473633, -0.24894842505455017], dtype=np.float32).reshape([2]), name="fc3.bias")

    # Large initializer: (32, 2), float32
    init_fc4_weight = numpy_helper.from_array(np.array([-0.3050042688846588, -0.5022183060646057, -0.22357073426246643, 0.42251116037368774, -0.4983120560646057, 0.009490966796875, 0.5915588736534119, -0.3283378481864929, -0.01595836877822876, -0.028841614723205566, 0.6066508889198303, 0.20319271087646484, -0.11213725805282593, 0.35145729780197144, 0.2634955048561096, 0.153325617313385, -0.4376702308654785, -0.5526032447814941, 0.00658106803894043, 0.6556068062782288, 0.004504501819610596, -0.6026971340179443, 0.2525041103363037, 0.5029323697090149, -0.1058042049407959, 0.42615777254104614, -0.5280840396881104, 0.3625950217247009, 0.37131887674331665, 0.40265554189682007, -0.20329642295837402, -0.6798629760742188, -0.3352510333061218, 0.17005795240402222, 0.08741140365600586, 0.5059658885002136, 0.6795781254768372, 0.1045846939086914, -0.1337704062461853, -0.2073783278465271, 0.2506939172744751, 0.5269473195075989, 0.5657345652580261, 0.46963006258010864, 0.4292488694190979, 0.13327836990356445, 0.054553449153900146, -0.6804316639900208, 0.08160090446472168, -0.3200286030769348, -0.4483662545681, -0.6901543140411377, -0.14189404249191284, 0.44901400804519653, -0.6569451689720154, 0.5746435523033142, -0.07017135620117188, 0.03245419263839722, 0.6452053189277649, 0.39681893587112427, 0.03497809171676636, -0.21917590498924255, 0.20107382535934448, 0.41325098276138306], dtype=np.float32).reshape([32, 2]), name="fc4.weight")

    init_fc4_bias = numpy_helper.from_array(np.array([-0.22586235404014587, 0.6725723147392273, -0.11613631248474121, -0.4656900465488434, 0.5415380597114563, 0.3854791522026062, -0.6075907945632935, -0.6804401278495789, -0.1099938154220581, 0.18168926239013672, 0.4779282212257385, 0.10520458221435547, -0.24042341113090515, -0.18301373720169067, 0.6792810559272766, -0.0768020749092102, 0.4809355139732361, 0.3052552342414856, 0.09314346313476562, -0.6927469968795776, -0.46420496702194214, -0.6207067966461182, 0.4669404625892639, -0.41397199034690857, 0.18114084005355835, -0.549919068813324, 0.3729715943336487, 0.08724349737167358, 0.015075445175170898, 0.5558727383613586, 0.24531781673431396, 0.639274537563324], dtype=np.float32).reshape([32]), name="fc4.bias")

    node0 = helper.make_node(
        "Gemm", ["onnx::Gemm_0", "fc1.weight", "fc1.bias"], ["/fc1/Gemm_output_0"],
        alpha=1.0,
        beta=1.0,
        transB=1)
    node1 = helper.make_node(
        "Gemm", ["/fc1/Gemm_output_0", "fc2.weight", "fc2.bias"], ["onnx::Add_10"],
        alpha=1.0,
        beta=1.0,
        transB=1)
    node2 = helper.make_node(
        "Gemm", ["/fc1/Gemm_output_0", "fc3.weight", "fc3.bias"], ["onnx::Mul_11"],
        alpha=1.0,
        beta=1.0,
        transB=1)
    node3 = helper.make_node(
        "Constant", [], ["/sampling/Constant_output_0"],
        value=numpy_helper.from_array(np.array([0.5], dtype=np.float32).reshape([]), name="value"))
    node4 = helper.make_node(
        "Mul", ["onnx::Mul_11", "/sampling/Constant_output_0"], ["/sampling/Mul_output_0"])
    node5 = helper.make_node(
        "Add", ["onnx::Add_10", "/sampling/Mul_output_0"], ["/sampling/Add_output_0"])
    node6 = helper.make_node(
        "Gemm", ["/sampling/Add_output_0", "fc4.weight", "fc4.bias"], ["15"],
        alpha=1.0,
        beta=1.0,
        transB=1)

    inp_onnx__Gemm_0 = helper.make_tensor_value_info("onnx::Gemm_0", TensorProto.FLOAT, [2, 32])

    out_onnx__Add_10 = helper.make_tensor_value_info("onnx::Add_10", TensorProto.FLOAT, [2, 2])
    out_onnx__Mul_11 = helper.make_tensor_value_info("onnx::Mul_11", TensorProto.FLOAT, [2, 2])
    out_n15 = helper.make_tensor_value_info("15", TensorProto.FLOAT, [2, 32])

    graph = helper.make_graph(
        [node0, node1, node2, node3, node4, node5, node6],
        "main_graph",
        [inp_onnx__Gemm_0],
        [out_onnx__Add_10, out_onnx__Mul_11, out_n15],
        initializer=[init_fc1_weight, init_fc1_bias, init_fc2_weight, init_fc2_bias, init_fc3_weight, init_fc3_bias, init_fc4_weight, init_fc4_bias],
    )
    model = helper.make_model(graph, opset_imports=[helper.make_operatorsetid("", OPSET_VERSION)])

    onnx.save(model, "graph_multiple_output_tracking.onnx")
    print(f"Finished exporting model to graph_multiple_output_tracking.onnx")


if __name__ == "__main__":
    main()
